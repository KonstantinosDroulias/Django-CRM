{% extends 'base.html' %}
{% load static %}

{% block title %}Lead {{ customer.name }}{% endblock %}

{% block body %}

<div class="flex justify-between items-center p-2w-full">
    <div>
        <a class="text-text" href="/customers">&larr; Go Back</a>
    </div>
    <div class="flex justify-end items-center gap-4">
    <button title="Delete Customer" class="px-2 py-2 bg-error shrink-0 flex items-center gap-3 hover:cursor-pointer rounded-sm shadow-sm" id="deleteTrigger"><img src="{% static 'img/trash.svg' %}" alt="Trash Icon"></button>
    <button title="Save Changes" class="px-2 py-2 bg-bg shrink-0 flex items-center gap-3 hover:cursor-pointer rounded-sm shadow-sm" id="updateCustomer"><img src="{% static 'img/save.svg' %}" alt="Save Icon"></button>
    </div>
</div>

<div class="z-30 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 hidden flex flex-col p-4 rounded-lg bg-bg shadow gap-4" id="confirmModule">
    <div>
    <p>Are you sure you want to delete this customer?</p>
    <p><strong>This action cannot be undone.</strong></p>
    </div>
    <div class="flex justify-center gap-6 items-center">
        <button id="deleteCancel" class="px-3 py-2 border hover:cursor-pointer">Cancel</button>
        <form method="POST" action="{% url 'delete_customer' customer.id %}">
        {% csrf_token %}
        <button type="submit" id="deleteBtn" class="px-3 py-2 border border-error bg-error hover:cursor-pointer flex items-center gap-1">Delete <img src="{% static 'img/delete.svg' %}" alt="Delete Icon"></button>
        </form>
    </div>
</div>
<div class="z-20 bg-black opacity-5 absolute top-0 left-0 w-full h-full hidden" id="confirmOverlay"></div>

<section class="grid grid-cols-1 lg:grid-cols-[3fr_1fr] gap-5">
    <div class="bg-bg p-5 rounded-lg shadow">
            <form class="space-y-4" action="" method="post">
            {% csrf_token %}

            <h1 class="text-text text-4xl font-bold mb-4">
                <input class="w-min" type="text" placeholder="First Name" name="first_name" value="{{ customer.first_name }}">
                <input class="w-min" type="text" placeholder="Last Name" name="last_name" value="{{ customer.last_name }}">
            </h1>

            <section class="grid grid-cols-2 items-center gap-6 mb-4 p-2">
                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">Address:</label>
                    <input type="text" placeholder="Address" name="address"
                           value="{{ customer.address }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">City:</label>
                    <input type="text" placeholder="City" name="city"
                           value="{{ customer.city }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">State:</label>
                    <input type="text" placeholder="State" name="state"
                           value="{{ customer.state }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">Country:</label>
                    <input type="text" placeholder="Country" name="country"
                           value="{{ customer.country }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>
            </section>


            <section class="grid grid-cols-2 items-center gap-6 mb-4 p-2">
                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">Company Name:</label>
                    <input type="text" placeholder="Company Name" name="company_name"
                           value="{{ customer.company_name }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">VAT ID:</label>
                    <input type="text" placeholder="VAT ID" name="vat_id"
                           value="{{ customer.vat_id }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">Email:</label>
                    <input type="text" placeholder="Email" name="email"
                           value="{{ customer.email }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>

                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">Phone:</label>
                    <input type="text" placeholder="Phone" name="phone"
                           value="{{ customer.phone_number }}"
                           class="border border-gray-300 rounded px-2 py-1">
                </div>
            </section>


            <section class="flex items-center gap-6 mb-4 p-2">
            <div class="flex gap-3 items-center">
            <label for="source">Source</label>
            <select class="pl-1 py-2 pr-3 bg-bg border-1 rounded-sm" name="source" id="source">
                {% for source in sources %}
                    <option value="{{ source.id }}"
                        {% if customer.source.id == source.id %}selected{% endif %}>
                        {{ source.name }}
                    </option>
                {% endfor %}
            </select>
            </div>
            <div class="flex gap-3 items-center">
            <label for="lead_status">Lead Status</label>
            <select class="pl-1 py-2 pr-3 bg-bg border-1 rounded-sm" name="lead_status" id="lead_status">
                {% for status in lead_status %}
                    <option value="{{ status.id }}"
                        {% if customer.lead_status.id == status.id %}selected{% endif %}>
                        {{ status.name }}
                    </option>
                {% endfor %}
            </select>
            </div>
            </section>

            <!--
            <section>
            Projects Completed. Total Revenue from Client. Unpaid invoices
            </section>
            -->

            <section class="p-3 border border-dashed border-gray-300 rounded-sm">
                <h2 class="text-text text-2xl">Projects</h2>
                <div class="flex items-center gap-1">
                    <hr class="w-full border-dashed border-gray-400">
                    <button title="Assign Employee" class="hover:cursor-pointer py-[2px] px-[9px] text-base rounded-full texxt-text bg-brand-400">+</button>
                </div>
            </section>

            <section class="flex flex-col">
                <label for="related_files" class="text-sm font-medium text-text">Upload Files <span class="text-gray-400">(jpg, png, pdf)</span></label>
                <input type="file" id="related_files" class="border border-dashed border-gray-300 text-gray-300 text-center rounded-sm p-5">
            </section>

            <section class="mb-4 p-2">
                <div class="flex flex-col">
                    <label class="text-sm font-medium text-text">Notes:</label>
                    <div class="flex w-full">
                    <textarea name="notes" id="notes" rows="6" class="border border-gray-300 rounded px-2 py-1 flex-1 shrink-0"></textarea>
                    <div class="flex flex-col overflow-y-scroll w-[200px] px-1">
                        {% for note in notes %}
                            <div class="p-2 hover:bg-gray-200">{{ note.title|truncatechars:20 }} - <span class="text-gray-400 text-sm">{{ note.updated_at }}</span></div>
                        {% endfor %}
                    </div>
                    </div>
                </div>
            </section>

        </form>
    </div>
    <div class="bg-bg p-5 rounded-lg shadow space-y-4 relative">
        <div class="flex items-center justify-between">
            <h2 class="text-xl">Assigned Employees</h2>
            <button id="assignBtn" title="Assign Employee" class="hover:cursor-pointer py-[2px] px-[9px] text-base rounded-full texxt-text bg-brand-400">+</button>
        </div>
        <hr class="border-gray-200">
        {% for user in customer.assigned_to.all %}
            {% include 'components/user.html' %}
        {% endfor %}
        <div id="employeeOverlay" class="hidden z-20 absolute top-14 right-0 p-4 rounded-lg shadow bg-bg w-[80%]">
            <div class="flex flex-col gap-4">
                <h3>Select:</h3>
                <hr>
                <div id="employeesList" class="space-y-5">
                    {% for user in users %}
                        {% if user in customer.assigned_to.all %}
                            <div class="my-2 p-1 bg-gray-100 hover:cursor-pointer">{% include 'components/user.html' %}</div>
                        {% else %}
                            <div class="my-2 p-1 hover:bg-gray-100 hover:cursor-pointer">{% include 'components/user.html' %}</div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
<div id="employeeOverlayBg" class="hidden z-10 absolute top-0 left-0 w-full h-full"></div>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/customer.js' %}"></script>
{% endblock %}