{% extends 'base.html' %}
{% load static %}

{% block title %}Single User{% endblock %}

{% block body %}

<section class="p-4 rounded-lg bg-bg shadow">
    <form id="userForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <input type="hidden" id="userId" name="user_id" value="{{ user_obj.id|default:'' }}">

        <div class="flex items-center gap-6 mb-8">
            <div class="w-24 h-24 rounded-full bg-gray-100 border border-gray-200 flex items-center justify-center overflow-hidden shrink-0">
                {% if user_obj.profile.avatar %}
                    <img src="{{ user_obj.profile.avatar.url }}" alt="User" class="w-full h-full object-cover">
                {% else %}
                    <img src="/media/avatars/avatar-placeholder.jpg" alt="User" class="w-full h-full object-cover">
                {% endif %}
            </div>

            <div>
                <label for="image_upload" class="cursor-pointer bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-sm text-sm font-medium hover:bg-gray-50 shadow-sm transition">
                    Upload Image
                </label>
                <input id="image_upload" name="image" type="file" class="hidden">
            </div>
        </div>

        <div class="grid grid-cols-12 gap-6">

            <div class="col-span-12 md:col-span-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <input type="text" id="username" name="username"
                       autocomplete="off"
                       value="{{ user_obj.username|default:'' }}"
                       placeholder="Username"
                       class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="password" name="password"
                       autocomplete="new-password"
                       {% if user_obj %}
                           value="••••••••"
                           disabled
                           class="w-full border border-gray-300 rounded px-3 py-2 bg-gray-100 text-gray-500 cursor-not-allowed focus:outline-none"
                       {% else %}
                           placeholder="Enter Password"
                           class="w-full border border-gray-300 rounded px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                       {% endif %}
                >
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                <input type="password" id="confirm_password"
                       {% if user_obj %}
                           value="••••••••"
                           disabled
                           class="w-full border border-gray-300 rounded px-3 py-2 bg-gray-100 text-gray-500 cursor-not-allowed focus:outline-none"
                       {% else %}
                           placeholder="Confirm Password"
                           class="w-full border border-gray-300 rounded px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                       {% endif %}
                >
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                <input type="text" id="first_name" name="first_name"
                       value="{{ user_obj.first_name|default:'' }}"
                       placeholder="First Name" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                <input type="text" id="last_name" name="last_name"
                       value="{{ user_obj.last_name|default:'' }}"
                       placeholder="Last Name" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="col-span-12 md:col-span-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="email" name="email"
                       value="{{ user_obj.email|default:'' }}"
                       placeholder="email@example.com" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="col-span-12 md:col-span-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                <div class="relative">
                    {% if perms.auth.add_user %}
                    <select id="role" name="groups" class="w-full border border-gray-300 rounded px-3 py-2 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    {% else %}
                    <select disabled id="role" name="groups" class="w-full border border-gray-300 rounded px-3 py-2 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    {% endif %}
                        <option value="">Select Role</option>
                        {% for group in all_groups %}
                            <option value="{{ group.id }}"
                                {% if group.id in user_group_ids %}selected{% endif %}>
                                {{ group.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>

            <div class="col-span-12 md:col-span-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                <input type="tel" id="phone" name="phone"
                       value="{{ user_obj.profile.phone_number|default:'' }}"
                       placeholder="+1 (555) 000-0000" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="col-span-12 md:col-span-3 flex flex-col justify-end">
                <div class="flex items-center justify-between border border-gray-200 rounded px-3 py-2 bg-gray-50">
                    <span class="text-sm font-medium text-gray-700">Status</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        {% if perms.auth.add_user %}
                        <input type="checkbox" id="is_active" name="is_active" class="sr-only peer"
                               {% if user_obj.is_active %}checked{% endif %}>
                        {% else %}
                        <input disabled type="checkbox" id="is_active" name="is_active" class="sr-only peer hover:cursor-not-allowed"
                           {% if user_obj.is_active %}checked{% endif %}>
                        {% endif %}
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                        <span class="ml-2 text-xs text-gray-500 peer-checked:text-green-600 font-medium">Active</span>
                    </label>
                </div>
            </div>

        </div>

        <div class="flex items-center justify-between mt-10 pt-6 border-t border-gray-100">
            <div class="flex gap-4">
                <button type="button" onclick="window.history.back()" class="px-6 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50 text-sm font-medium transition cursor-pointer">
                    Cancel
                </button>
                {% if perms.auth.add_user %}
                <button type="submit"
                    name="action"
                    value="delete"
                    class="px-6 py-2 border border-red-200 text-red-600 rounded hover:bg-red-50 text-sm font-medium transition cursor-pointer">
                    Delete
                </button>
                {% endif %}
            </div>

            <button type="button" id="saveUserBtn" class="px-8 py-2 bg-black text-white rounded hover:bg-gray-800 text-sm font-medium shadow-sm transition cursor-pointer">
                Update
            </button>
        </div>
    </form>
</section>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/user.js' %}"></script>
{% endblock %}